---
title: "HW12: Logistisc Regression, LMM "
format: pdf
editor: visual
---

## Question 1: CRP and Logistic Regression

### 

$Log(\frac{pi}{1-pi}) ~ \mu + \beta_{age}X_{age}$

$Log(\frac{pi}{1-pi}) ~ \mu + \beta_{age}X_{age} + \beta_{sex}X_{sex}$

\$ Log(\frac{pi}{1-pi}) \~ \mu + \beta\*{age}X{age} +\* \beta{sex}X{sex} + \beta{age*sex}X\_{age\*sex} \$

### 

```{r}

# converts pi to odds

prob2odds <- function(p_i) {
  odds <- p_i / (1 - p_i)
  return(odds)
}

#converts odds to Ni

logit <- function(p_i) {
  eta_i <- log(p_i / (1 - p_i))
  return(eta_i)
}

#converts Ni back to pi

inv.logit <- function(eta_i) {
  p_i <- exp(eta_i) / (1 + exp(eta_i))
  return(p_i)
}

```

### 

Log model

$\log\left(\frac{p_i}{1 - p_i}\right) = \beta_0 + \beta_{\text{gender}} \cdot \text{gender}i + \beta{\text{age}} \cdot \text{age}_i$

male = 0 and female = 1

Odds for Male (gender = 0):

\$\log\left(\frac{p_{male}}{1 - p_{male}} \right) = \beta\*0 +\* \beta{age} \* 30 \$

Expo on both sides

\$\left(\frac{p_{male}}{1-p{_{male}}} \right) = e\^{\beta\*{0}+\*\beta{age}\*30} \$

Odds for Female (gender = 1):

\$\log\left(\frac{p_{female}}{1 - {female}} \right) = \beta\*0 +\* \beta{gender} + \beta\_{age} \* 30 \$

Expo on Both sides

\$\left(\frac{p_{female}}{1-p{_{female}}} \right) = e\^{\beta\*{0}+\*\beta{gender} + \beta{age}\*30} \$

Express female offs in-terms of male odds

\$\frac{p_{female}}{1-p_{female}} = e\^{\beta{gender}}x \frac{p_{male}}{1-p_{male}} \$

And since the male version is the same as female without the $e^{\beta_{gender}}$ we can substitute it:

\$\frac{p_{female}}{1-p{female}} = e\^{{\beta\_{gender}} x \frac{p_{male}}{1-p_{male}}} \$

And thus:

odds(female,30) = $e^{\beta_{gender}}$ X odds(male,30)

B

```{r}
#read in crp and add new status column
crp <- read.csv("crp.csv")
crp$status <- ifelse(crp$CRP > 4.5,1,0)

#fitting new models

fit.a <- glm(status ~ 1 + Age, data = crp, family = "binomial")
fit.as <- glm(status ~ 1 + Age + Gender, data = crp, family = "binomial")
fit.axs <- glm(status ~ 1 + Age + Gender + Age*Gender, data = crp, family = "binomial")

```

B:i

```{r}
#takin the age coeficent from the model above
beta_age <- coef(fit.a)["Age"]

#mulitply by 10 to see how it changes for a decade
odds_ratio_decade <- exp(beta_age * 10)
print(odds_ratio_decade)

```

B: ii

```{r}

ageCI<- confint(fit.a, level = 0.95)
cat("Lower CI:",ageCI[2,1], "\n", "Upper CI:", ageCI[2,2] )

```

B:iii

```{r}

beta_sex <- coef(fit.as)[3]
beta_age <- coef(fit.as)[2]

# Log-odds for a 32-year-old female
female_32 <- coef(fit.as)[1] + beta_age * 32 + beta_sex

# Log-odds for a 57-year-old female
female_57 <- coef(fit.as)[1] + beta_age * 57 + beta_sex

# Odds ratios
odds_ratio_32 <- exp(female_32)
odds_ratio_57 <- exp(female_57) 

# Print results
print(odds_ratio_32)
print(odds_ratio_57)

#FIX ME/ CHECK THIS

oddsratio.tots <- odds_ratio_57 / odds_ratio_32
print(oddsratio.tots)

```

B: iv

```{r}

beta_sex <- coef(fit.axs)[3]
beta_age <- coef(fit.axs)[2]
beta_int <- coef(fit.axs)[4]

# Log-odds for a 32-year-old female
female_32 <- coef(fit.axs)[1] + beta_age * 32 + beta_sex

# Log-odds for a 57-year-old female
female_57 <- coef(fit.as)[1] + beta_age * 57 + beta_sex

# Odds ratios
odds_ratio_32 <- exp(female_32)
odds_ratio_57 <- exp(female_57) 

# Print results
print(odds_ratio_32)
print(odds_ratio_57)
oddsratio.tots <- odds_ratio_57 / odds_ratio_32
print(oddsratio.tots)


```

B: V

**If the odds ratio of an effect is not significant, what value must its confidence interval cover?**

INSERT TEXT HERE TO ANSWER THE QUESTION


B: vi 

```{r}
# df for the newdata to fit into the model
highcrpmale <- data.frame(Age = 32, Gender = 0)

#predicting base on the model + new data
male.pred <- predict.glm(fit.as,newdata = highcrpmale, type = "response" )

print(male.pred)


```

B: vii

```{r}
library(ggplot2)

prediction <- predict.glm(fit.a, type = "response")

ggplot(crp, aes(x = Age, y = status))+ 
  geom_point(alpha = 0.5)+
  stat_smooth(method = "glm", se = TRUE, method.args = list(family = binomial))
# change axis labels + titles





```


C: Sig
lect 21 page 8

- models, one with int vs age, one int vs add 
same as hw11 b ii 

```{r}
# log likes of the different models
age <- logLik(fit.a)
age.sex <- logLik(fit.as)
agexsex <- logLik(fit.axs)

#filling in above values for the 
LRT <- 2*(agexsex - age.sex)
pvals <- (1- pchisq(LRT, df = 1))

LTR2 <- 2*(agexsex - age)
pvals2 <- (1- pchisq(LTR2, df = 2))


#model comparisons
chi <- anova(fit.axs, test = "Chisq")
lts.test <- anova(fit.axs, fit.as, test = "LRT")

print(chi[5])
print(lts.test[5])



```

D:iii

```{r}

crp$cutoff <- ifelse(crp$CRP > 15,1,0)

print(stem(crp$cutoff))
print(stem(crp$status))

# print the different stem plots and talk about the proportion of data we're seeing. So we don't want to be cutting off information available etc

```

E:
Make 2 models and make sure they are using status as the pred term using lm and glm
anova(model, test LRT)

```{r}



```


